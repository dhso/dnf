#!/bin/bash

pids=$(pgrep -f StartLogin)

for pid_to_kill in $pids; do
    echo -e "\e[91mkill process PID: $pid_to_kill\e[0m"
    kill "$pid_to_kill"
done


pids2=$(pgrep -f Gatewayd)
for pid_to_kill2 in $pids2; do
    echo -e "\e[91mkill process PID: $pid_to_kill2\e[0m"
    kill "$pid_to_kill2" > /dev/null 2>&1 &
done

ulimit -n 65535

printf "Leishen-2025-Thunder-NICE-8888\n" | /root/StartLogin start &
sleep 5

chmod 755 /root/Gatewayd
/root/Gatewayd &

# 使用无限循环保持脚本运行，而不是单纯的 wait
while true; do
    # 检查关键进程是否还在运行
    if ! pgrep -f StartLogin > /dev/null; then
        echo "[ERROR] StartLogin died, restarting..."
        /root/StartLogin start &
    fi
    
    if ! pgrep -f Gatewayd > /dev/null; then
        echo "[ERROR] Gatewayd died, restarting..."
        /root/Gatewayd &
    fi
    
    sleep 10  # 每 10 秒检查一次
done

